import './StockChart.css';
import { useState } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } from 'recharts';

const fetched = {
    0: {
        "2024-02-27 19:55:00": {
            "1. open": "185.0800",
            "2. high": "185.0900",
            "3. low": "184.7400",
            "4. close": "185.0900",
            "5. volume": "84"
        },
        "2024-02-27 19:30:00": {
            "1. open": "185.0900",
            "2. high": "185.0900",
            "3. low": "185.0000",
            "4. close": "185.0000",
            "5. volume": "51"
        },
        "2024-02-27 19:25:00": {
            "1. open": "185.0000",
            "2. high": "185.0000",
            "3. low": "185.0000",
            "4. close": "185.0000",
            "5. volume": "10"
        },
        "2024-02-27 19:20:00": {
            "1. open": "184.9600",
            "2. high": "185.0000",
            "3. low": "184.6000",
            "4. close": "184.6000",
            "5. volume": "202"
        },
        "2024-02-27 19:00:00": {
            "1. open": "184.8700",
            "2. high": "185.0800",
            "3. low": "184.6000",
            "4. close": "184.6400",
            "5. volume": "553513"
        },
        "2024-02-27 18:50:00": {
            "1. open": "185.0900",
            "2. high": "185.0900",
            "3. low": "185.0900",
            "4. close": "185.0900",
            "5. volume": "40"
        },
        "2024-02-27 18:40:00": {
            "1. open": "184.8700",
            "2. high": "185.0900",
            "3. low": "184.8700",
            "4. close": "185.0900",
            "5. volume": "18"
        },
        "2024-02-27 18:35:00": {
            "1. open": "185.0900",
            "2. high": "185.0900",
            "3. low": "185.0900",
            "4. close": "185.0900",
            "5. volume": "29"
        },
        "2024-02-27 18:30:00": {
            "1. open": "184.8700",
            "2. high": "185.0000",
            "3. low": "184.8700",
            "4. close": "185.0000",
            "5. volume": "553490"
        },
        "2024-02-27 18:25:00": {
            "1. open": "185.0900",
            "2. high": "185.0900",
            "3. low": "185.0900",
            "4. close": "185.0900",
            "5. volume": "2"
        },
        "2024-02-27 18:20:00": {
            "1. open": "185.0100",
            "2. high": "185.1000",
            "3. low": "185.0000",
            "4. close": "185.1000",
            "5. volume": "45"
        },
        "2024-02-27 18:10:00": {
            "1. open": "185.0000",
            "2. high": "185.0000",
            "3. low": "185.0000",
            "4. close": "185.0000",
            "5. volume": "1"
        },
        "2024-02-27 18:05:00": {
            "1. open": "185.0000",
            "2. high": "185.0000",
            "3. low": "185.0000",
            "4. close": "185.0000",
            "5. volume": "1"
        },
        "2024-02-27 18:00:00": {
            "1. open": "185.0000",
            "2. high": "185.0000",
            "3. low": "185.0000",
            "4. close": "185.0000",
            "5. volume": "1"
        },
        "2024-02-27 17:55:00": {
            "1. open": "184.0000",
            "2. high": "185.0000",
            "3. low": "184.0000",
            "4. close": "185.0000",
            "5. volume": "111"
        },
        "2024-02-27 17:45:00": {
            "1. open": "183.4600",
            "2. high": "183.4600",
            "3. low": "183.0700",
            "4. close": "183.0700",
            "5. volume": "7"
        },
        "2024-02-27 17:40:00": {
            "1. open": "184.9400",
            "2. high": "184.9400",
            "3. low": "183.4410",
            "4. close": "183.6500",
            "5. volume": "124"
        },
        "2024-02-27 17:35:00": {
            "1. open": "183.6100",
            "2. high": "185.0000",
            "3. low": "183.1200",
            "4. close": "185.0000",
            "5. volume": "18"
        },
        "2024-02-27 17:30:00": {
            "1. open": "184.9000",
            "2. high": "184.9000",
            "3. low": "183.5590",
            "4. close": "183.7110",
            "5. volume": "105"
        },
        "2024-02-27 17:25:00": {
            "1. open": "184.9200",
            "2. high": "185.0000",
            "3. low": "184.9200",
            "4. close": "184.9200",
            "5. volume": "9"
        },
        "2024-02-27 17:15:00": {
            "1. open": "185.0000",
            "2. high": "185.0000",
            "3. low": "184.9200",
            "4. close": "185.0000",
            "5. volume": "211"
        },
        "2024-02-27 17:10:00": {
            "1. open": "184.9200",
            "2. high": "185.0000",
            "3. low": "184.8700",
            "4. close": "185.0000",
            "5. volume": "10951"
        } 
    }, 1: {
        "2024-02-27": {
            "1. open": "278.1",
            "2. high": "280.3",
            "3. low": "275.9",
            "4. close": "277.6",
            "5. adjusted close": "277.6",
            "6. volume": "9635382",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-26": {
            "1. open": "279.5",
            "2. high": "280.0",
            "3. low": "277.4",
            "4. close": "278.5",
            "5. adjusted close": "278.5",
            "6. volume": "14325750",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-23": {
            "1. open": "276.8",
            "2. high": "279.7",
            "3. low": "276.8",
            "4. close": "279.7",
            "5. adjusted close": "279.7",
            "6. volume": "15990330",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-22": {
            "1. open": "284.0",
            "2. high": "284.3",
            "3. low": "275.9",
            "4. close": "276.8",
            "5. adjusted close": "276.8",
            "6. volume": "20826789",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-21": {
            "1. open": "285.6",
            "2. high": "288.8",
            "3. low": "283.1",
            "4. close": "285.5",
            "5. adjusted close": "285.5",
            "6. volume": "18231400",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-20": {
            "1. open": "281.2",
            "2. high": "285.3",
            "3. low": "281.2",
            "4. close": "284.5",
            "5. adjusted close": "284.5",
            "6. volume": "11066120",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-19": {
            "1. open": "279.5",
            "2. high": "281.5",
            "3. low": "278.6",
            "4. close": "281.1",
            "5. adjusted close": "281.1",
            "6. volume": "27436670",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-16": {
            "1. open": "276.6",
            "2. high": "280.1",
            "3. low": "275.636",
            "4. close": "279.6",
            "5. adjusted close": "279.6",
            "6. volume": "40962738",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-15": {
            "1. open": "278.1",
            "2. high": "278.4",
            "3. low": "274.0",
            "4. close": "276.2",
            "5. adjusted close": "276.2",
            "6. volume": "22333750",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-14": {
            "1. open": "275.7",
            "2. high": "278.8",
            "3. low": "275.7",
            "4. close": "277.2",
            "5. adjusted close": "277.2",
            "6. volume": "17059900",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-13": {
            "1. open": "278.8",
            "2. high": "279.2",
            "3. low": "272.3",
            "4. close": "273.7",
            "5. adjusted close": "273.7",
            "6. volume": "24051109",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-12": {
            "1. open": "281.3",
            "2. high": "281.8",
            "3. low": "278.0",
            "4. close": "279.6",
            "5. adjusted close": "279.6",
            "6. volume": "13404100",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-09": {
            "1. open": "284.5",
            "2. high": "287.2",
            "3. low": "279.9",
            "4. close": "280.5",
            "5. adjusted close": "280.5",
            "6. volume": "14468320",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-08": {
            "1. open": "280.1",
            "2. high": "282.9",
            "3. low": "278.9",
            "4. close": "280.4",
            "5. adjusted close": "280.4",
            "6. volume": "14538140",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-07": {
            "1. open": "290.2",
            "2. high": "290.6",
            "3. low": "280.0",
            "4. close": "280.0",
            "5. adjusted close": "280.0",
            "6. volume": "20561150",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-06": {
            "1. open": "291.2",
            "2. high": "293.2",
            "3. low": "287.9",
            "4. close": "289.9",
            "5. adjusted close": "289.9",
            "6. volume": "10955420",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-05": {
            "1. open": "290.8",
            "2. high": "294.2",
            "3. low": "289.7",
            "4. close": "289.8",
            "5. adjusted close": "289.8",
            "6. volume": "27142580",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        },
        "2024-02-02": {
            "1. open": "287.0",
            "2. high": "293.0",
            "3. low": "285.5873",
            "4. close": "290.8",
            "5. adjusted close": "290.8",
            "6. volume": "47106801",
            "7. dividend amount": "0.0000",
            "8. split coefficient": "1.0"
        }
    }, 2: {
        "2024-02-27": {
            "1. open": "185.6000",
            "2. high": "186.1250",
            "3. low": "182.6200",
            "4. close": "184.8700",
            "5. volume": "8262193"
        },
        "2024-02-23": {
            "1. open": "187.6400",
            "2. high": "188.7700",
            "3. low": "178.7500",
            "4. close": "185.7200",
            "5. volume": "17487852"
        },
        "2024-02-16": {
            "1. open": "185.9000",
            "2. high": "188.9500",
            "3. low": "182.2600",
            "4. close": "187.6400",
            "5. volume": "21745006"
        },
        "2024-02-09": {
            "1. open": "185.5100",
            "2. high": "187.1800",
            "3. low": "181.4900",
            "4. close": "186.3400",
            "5. volume": "22784812"
        },
        "2024-02-02": {
            "1. open": "187.4600",
            "2. high": "189.4600",
            "3. low": "182.7100",
            "4. close": "185.7900",
            "5. volume": "28283876"
        },
        "2024-01-26": {
            "1. open": "172.8200",
            "2. high": "196.9000",
            "3. low": "172.4000",
            "4. close": "187.4200",
            "5. volume": "56232762"
        },
        "2024-01-19": {
            "1. open": "165.8000",
            "2. high": "171.5791",
            "3. low": "165.0400",
            "4. close": "171.4800",
            "5. volume": "19864308"
        },
        "2024-01-12": {
            "1. open": "158.6900",
            "2. high": "165.9800",
            "3. low": "157.8850",
            "4. close": "165.8000",
            "5. volume": "17643392"
        },
        "2024-01-05": {
            "1. open": "162.8300",
            "2. high": "163.2900",
            "3. low": "158.6700",
            "4. close": "159.1600",
            "5. volume": "14822074"
        },
        "2023-12-29": {
            "1. open": "162.2300",
            "2. high": "164.1800",
            "3. low": "162.0500",
            "4. close": "163.5500",
            "5. volume": "9376537"
        },
        "2023-12-22": {
            "1. open": "162.2300",
            "2. high": "163.3300",
            "3. low": "159.5300",
            "4. close": "162.1400",
            "5. volume": "17686398"
        },
        "2023-12-15": {
            "1. open": "162.6800",
            "2. high": "166.3400",
            "3. low": "160.1490",
            "4. close": "162.2300",
            "5. volume": "33504550"
        },
        "2023-12-08": {
            "1. open": "160.2900",
            "2. high": "162.7900",
            "3. low": "159.9700",
            "4. close": "161.9600",
            "5. volume": "21918957"
        },
        "2023-12-01": {
            "1. open": "154.9900",
            "2. high": "160.5900",
            "3. low": "154.7500",
            "4. close": "160.5500",
            "5. volume": "21900644"
        },
        "2023-11-24": {
            "1. open": "152.5100",
            "2. high": "155.7050",
            "3. low": "152.3500",
            "4. close": "155.1800",
            "5. volume": "11362696"
        },
        "2023-11-17": {
            "1. open": "148.4600",
            "2. high": "153.5000",
            "3. low": "147.3500",
            "4. close": "152.8900",
            "5. volume": "19547595"
        },
        "2023-11-10": {
            "1. open": "147.8900",
            "2. high": "149.6800",
            "3. low": "145.2800",
            "4. close": "149.0200",
            "5. volume": "18357944"
        },
        "2023-11-03": {
            "1. open": "143.1900",
            "2. high": "148.4450",
            "3. low": "142.5800",
            "4. close": "147.9000",
            "5. volume": "22959464"
        },
        "2023-10-27": {
            "1. open": "136.6300",
            "2. high": "144.7000",
            "3. low": "135.8700",
            "4. close": "142.5200",
            "5. volume": "30227448"
        },
        "2023-10-20": {
            "1. open": "139.2800",
            "2. high": "140.6200",
            "3. low": "136.3100",
            "4. close": "137.1600",
            "5. volume": "21044049"
        },
        "2023-10-13": {
            "1. open": "142.3000",
            "2. high": "143.4150",
            "3. low": "138.2700",
            "4. close": "138.4600",
            "5. volume": "16386334"
        },
        "2023-10-06": {
            "1. open": "140.0400",
            "2. high": "142.9400",
            "3. low": "139.8600",
            "4. close": "142.0300",
            "5. volume": "15932918"
        },
        "2023-09-29": {
            "1. open": "146.5700",
            "2. high": "147.4300",
            "3. low": "139.6100",
            "4. close": "140.3000",
            "5. volume": "23445425"
        },
        "2023-09-22": {
            "1. open": "145.7700",
            "2. high": "151.9299",
            "3. low": "144.6600",
            "4. close": "146.9100",
            "5. volume": "23597168"
        },
        "2023-09-15": {
            "1. open": "148.5700",
            "2. high": "148.7800",
            "3. low": "145.5300",
            "4. close": "145.9900",
            "5. volume": "19316647"
        },
        "2023-09-08": {
            "1. open": "147.9100",
            "2. high": "149.0000",
            "3. low": "147.1200",
            "4. close": "147.6800",
            "5. volume": "13719451"
        },
        "2023-09-01": {
            "1. open": "145.4100",
            "2. high": "148.1000",
            "3. low": "145.2100",
            "4. close": "147.9400",
            "5. volume": "15198607"
        }
    }, 3: {
        "2024-02-27": {
            "1. open": "183.6300",
            "2. high": "188.9500",
            "3. low": "178.7500",
            "4. close": "184.8700",
            "5. volume": "79004718"
        },
        "2024-01-31": {
            "1. open": "162.8300",
            "2. high": "196.9000",
            "3. low": "157.8850",
            "4. close": "183.6600",
            "5. volume": "128121557"
        },
        "2023-12-29": {
            "1. open": "158.4100",
            "2. high": "166.3400",
            "3. low": "158.0000",
            "4. close": "163.5500",
            "5. volume": "87358302"
        },
        "2023-11-30": {
            "1. open": "145.0000",
            "2. high": "158.6000",
            "3. low": "144.4500",
            "4. close": "158.5600",
            "5. volume": "78460252"
        },
        "2023-10-31": {
            "1. open": "140.0400",
            "2. high": "144.7600",
            "3. low": "135.8700",
            "4. close": "144.6400",
            "5. volume": "94386980"
        },
        "2023-09-29": {
            "1. open": "147.2600",
            "2. high": "151.9299",
            "3. low": "139.6100",
            "4. close": "140.3000",
            "5. volume": "82806487"
        },
        "2023-08-31": {
            "1. open": "144.2500",
            "2. high": "147.7275",
            "3. low": "139.7600",
            "4. close": "146.8300",
            "5. volume": "84274205"
        },
        "2023-07-31": {
            "1. open": "133.4200",
            "2. high": "144.6050",
            "3. low": "131.5500",
            "4. close": "144.1800",
            "5. volume": "85778938"
        },
        "2023-06-30": {
            "1. open": "128.4400",
            "2. high": "139.4690",
            "3. low": "127.7800",
            "4. close": "133.8100",
            "5. volume": "100722016"
        },
        "2023-05-31": {
            "1. open": "126.3500",
            "2. high": "130.0699",
            "3. low": "120.5500",
            "4. close": "128.5900",
            "5. volume": "95710890"
        },
        "2023-04-28": {
            "1. open": "130.9700",
            "2. high": "132.6100",
            "3. low": "124.5600",
            "4. close": "126.4100",
            "5. volume": "83664114"
        },
        "2023-03-31": {
            "1. open": "128.9000",
            "2. high": "131.4800",
            "3. low": "121.7100",
            "4. close": "131.0900",
            "5. volume": "138093084"
        },
        "2023-02-28": {
            "1. open": "134.4900",
            "2. high": "137.3900",
            "3. low": "128.8600",
            "4. close": "129.3000",
            "5. volume": "76080679"
        },
        "2023-01-31": {
            "1. open": "141.1000",
            "2. high": "147.1800",
            "3. low": "132.9800",
            "4. close": "134.7300",
            "5. volume": "105576019"
        },
        "2022-12-30": {
            "1. open": "149.9800",
            "2. high": "153.2100",
            "3. low": "137.1950",
            "4. close": "140.8900",
            "5. volume": "86426226"
        },
        "2022-11-30": {
            "1. open": "138.2500",
            "2. high": "150.4600",
            "3. low": "133.9700",
            "4. close": "148.9000",
            "5. volume": "93620235"
        },
        "2022-10-31": {
            "1. open": "120.1600",
            "2. high": "138.8615",
            "3. low": "115.5450",
            "4. close": "138.2900",
            "5. volume": "113480787"
        },
        "2022-09-30": {
            "1. open": "128.4000",
            "2. high": "130.9900",
            "3. low": "118.6100",
            "4. close": "118.8100",
            "5. volume": "87256958"
        },
        "2022-08-31": {
            "1. open": "130.7500",
            "2. high": "139.3400",
            "3. low": "128.4000",
            "4. close": "128.4500",
            "5. volume": "77392342"
        },
        "2022-07-29": {
            "1. open": "141.0000",
            "2. high": "141.8700",
            "3. low": "125.1300",
            "4. close": "130.7900",
            "5. volume": "129801061"
        },
        "2022-06-30": {
            "1. open": "139.6700",
            "2. high": "144.7300",
            "3. low": "132.8500",
            "4. close": "141.1900",
            "5. volume": "105815743"
        },
        "2022-05-31": {
            "1. open": "133.0000",
            "2. high": "139.8300",
            "3. low": "125.8000",
            "4. close": "138.8400",
            "5. volume": "113207659"
        },
        "2022-04-29": {
            "1. open": "129.6600",
            "2. high": "141.8800",
            "3. low": "124.9100",
            "4. close": "132.2100",
            "5. volume": "107525264"
        },
        "2022-03-31": {
            "1. open": "122.6700",
            "2. high": "133.0800",
            "3. low": "120.7000",
            "4. close": "130.0200",
            "5. volume": "96447210"
        }
    }
};

function StockChart({ companyID }) {

    const [timeScale, setTimeScale] = useState(0);

    const timeScaleToInfo = [
        {name: "1D", count: 100, type: 0},         //1D (intraday)
        {name: "1W", count: 7, type: 1},           //1W (daily)
        {name: "1M", count: 30, type: 1},          //1M (daily)
        {name: "1Y", count: 52, type: 2},          //1Y (weekly)
        {name: "MAX", count: Infinity, type: 3}    //MAX (monthly)
    ];

    // use companyID to fetch data
    const produceAllData = () => {
        let allData = [];
        for (let i=0; i<4; i++) {
            const keys = Object.keys(fetched[i]);
            let dataArray = [];

            for (const key of [...keys].reverse()) {
                dataArray.push({date: key, price: parseFloat( fetched[i][key]["4. close"])});
            }
            allData.push(dataArray);
        }

        return allData;
    }
    const allData = produceAllData();
    // fetched data now stored in allData

    // const chartData = [
    //     { date: '2023-01-01', price: 100 },
    //     { date: '2023-01-02', price: 105 },
    //     { date: '2023-01-03', price: 110 },
    //     { date: '2023-01-04', price: 108 },
    //     { date: '2023-01-05', price: 112 },
    //     { date: '2023-01-06', price: 115 },
    // ];

    const getChartData = () => {
        const data = allData[timeScaleToInfo[timeScale].type];
        return data.slice(0, Math.min(data.length, timeScaleToInfo[timeScale].count));
    }

    const chartData = getChartData();

    return (
        <>
        <div id='stock-chart'>
            <div className='chart-area'>
                <ResponsiveContainer width="100%" height="100%">
                    <LineChart width={800} height={400} data={chartData} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                        <CartesianGrid strokeDasharray="3 3" />
                        <XAxis dataKey="date" />
                        <YAxis />
                        <Tooltip />
                        {/* <Legend /> */}
                        <Line type="monotone" dataKey="price" stroke="#0d1f2d" activeDot={{ r: 8 }} />
                    </LineChart>
                </ResponsiveContainer>
            </div>
            <div className='btn-area'>
                {timeScaleToInfo.map((info, index) => (
                    <div className='btn-container'>
                        <button key={index} onClick={()=>{setTimeScale(index)}}>{info.name}</button>
                    </div>
                ))}
            </div>
        </div>
        </>
    );
}

export default StockChart;
